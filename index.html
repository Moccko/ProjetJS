<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.png">
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-awusxf8AUojygHf2+joICySzB780jVvQaVCAt1clU3QsyAitLGul28Qxb2r1e5g+" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDzxhXaQR4V9itywOW6X048_9qZEw03uOg&sensor=false"></script>

    <title>React App</title>
</head>
<body>
<script type="text/javascript">
    function updateClock() {
        let currentTime = new Date();
        let currentHours = ('0' + currentTime.getHours()).slice(-2);
        let currentMinutes = ('0' + currentTime.getMinutes()).slice(-2);
        let currentSeconds = ('0' + currentTime.getSeconds()).slice(-2);

        let hm = currentHours + ':' + currentMinutes;
        let s = ':' + currentSeconds;

        let days = [
            "",
            "Lundi",
            "Mardi",
            "Mercredi",
            "Jeudi",
            "Vendredi",
            "Samedi",
            "Dimanche"
        ];
        let months = [
            "Janvier",
            "Février",
            "Mars",
            "Avril",
            "Mai",
            "Juin",
            "Juillet",
            "Août",
            "Septembre",
            "Octobre",
            "Novembre",
            "Décembre"
        ];

        let currentDayString = days[currentTime.getDay()] + " " + currentTime.getDate() + " " + months[currentTime.getMonth()] + " " + currentTime.getFullYear();

        $("#hour").text(hm).append($('<small></small>').text(s));
        $('#date').text(currentDayString);

    }

    function googleSearch() {
        var google = 'https://www.google.fr/#newwindow=1&q=';
        google += encodeURI($('#search').val());
        window.location.href = google;
    }

    function getWeather(position) {
        const apiKey = 'b23b6e94de1f403ca2312a227ed208c5';
        const lat = position.coords.latitude;
        const long = position.coords.longitude;
        let weather = 'http://api.openweathermap.org/data/2.5/weather?';
        let forecast = 'http://api.openweathermap.org/data/2.5/forecast?';
        let parameters = 'lat=' + lat;
        parameters += '&lon=' + long;
        parameters += '&lang=' + navigator.language;
        parameters += '&units=metric';
        parameters += '&appid=' + apiKey;
        $.getJSON(weather + parameters, function (data) {
            $('#town').text(data.name);
            $('#temp').text(data.main.temp + "°C");
            const icon = 'http://openweathermap.org/img/w/' + data.weather["0"].icon + '.png';
            $('#icon').attr('src', icon);
        });
        $.getJSON(forecast + parameters, function (data) {
            console.debug(data);
            $('#tempmin').text(data.list["0"].main.temp_min + "°C");
            $('#tempmax').text(data.list["0"].main.temp_max + "°C");
        })
    }

    function updateWeather() {
        var city = $('#ville').val();
        if (city === '') {
            navigator.geolocation.getCurrentPosition(getWeather);
        } else {
            city = city.toLowerCase();
            city.replace(/\s+/g, '');
            console.log(city);
            getCityWeather(city);
        }
    }

    function getCityWeather(town) {
        const apiKey = 'b23b6e94de1f403ca2312a227ed208c5';
        let weather = 'http://api.openweathermap.org/data/2.5/weather?';
        let forecast = 'http://api.openweathermap.org/data/2.5/forecast?';
        let parameters = 'q=' + town;
        parameters += '&lang=' + navigator.language;
        parameters += '&units=metric';
        parameters += '&appid=' + apiKey;
        $.getJSON(weather + parameters, function (data) {
            $('#town').text(data.name);
            $('#temp').text(data.main.temp + "°C");
            const icon = 'http://openweathermap.org/img/w/' + data.weather["0"].icon + '.png';
            $('#icon').attr('src', icon);
        });
        $.getJSON(forecast + parameters, function (data) {
            console.debug(data);
            $('#tempmin').text(data.list["0"].main.temp_min + "°C");
            $('#tempmax').text(data.list["0"].main.temp_max + "°C");
        });
    }

    function youtubeSearch() {
        var fr = document.getElementById("ytplayer");
        fr.src = "http://www.youtube.com/embed?listType=search&list=" + $('#yt').val();
    }

    var geocoder;
    var map;
    var markers = new Array();
    var i = 0;

    function initialize() {
        geocoder = new google.maps.Geocoder();
        var myOptions = {
            zoom: 15,
            center: new google.maps.LatLng(44.7899772, -0.6148396),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('map'), myOptions);
        document.getElementById("mapSearch").value = "Rue Naudet, Gradignan";
        codeAddress("Rue Naudet, Gradignan");
    }

    function Deplace() {
        var address = document.getElementById("mapSearch").value;
        codeAddress(address);
    }

    function codeAddress(address) {
        /* Appel au service de geocodage avec l'adresse en paramètre */
        geocoder.geocode({'address': address}, function (results, status) {
            /* Si l'adresse a pu être géolocalisée */
            if (status == google.maps.GeocoderStatus.OK) {
                map.setCenter(results[0].geometry.location);
                /* Affichage du marker */
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });
                /* Permet de supprimer le marker précédemment affiché */
                markers.push(marker);
                if (markers.length > 1)
                    markers[(i - 1)].setMap(null);
                i++;
            } else {
                alert("Le geocodage n\'a pu etre effectue pour la raison suivante: " + status);
            }
        });
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    $(document).ready(function () {
        setInterval('updateClock()', 1000);
        navigator.geolocation.getCurrentPosition(getWeather);
        navigator.geolocation.getCurrentPosition(initialize);
    });
</script>

<nav class="navbar navbar-default" role="navigation">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#" style="padding: 10px"><img src="ireact.png" height="100%"></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <form class="navbar-form navbar-right" role="search">
            <div class="form-group input-group">
                <input id="search" type="text" class="form-control" placeholder="Search...">
                <span class="input-group-btn">
            <button class="btn btn-default" onclick="googleSearch()" type="button">
              <span class="glyphicon glyphicon-search"></span>
            </button>
          </span>
            </div>
        </form>
    </div>
</nav>

<div class="container">
    <div class="col-md-4">
        <div class="panel panel-info">
            <div class="panel-heading">
                <h3 class="panel-title">Clock</h3>
                <span class="glyphicon glyphicon-trash close"></span>
            </div>
            <div class="panel-body">
                <h1 id="hour"></h1>
                <h3 id="date"></h3>
            </div>
        </div>
    </div>
    <div class="col-md-4 col-lg-4">
        <div class="panel panel-warning">
            <div class="panel-heading">
                <h3 class="panel-title">Weather</h3>
            </div>
            <div class="panel-body">
                <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
                    <img id="icon" src=""/>
                </div>
                <div class="input-group col-md-9 has-warning">
                    <input type="text" class="form-control" placeholder="Ville" id="ville">
                    <div class="input-group-btn">
                        <button class="btn btn-warning" type="submit" onclick="updateWeather()">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </div>
                </div>
                <h2 id="town" class="col-xs-12 col-sm-12 col-md-12 col-lg-12"></h2>
                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6">Temp&eacute;rature <span id="temp"></span></h4>
                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                    <p class="col-xs-6 col-sm-6 col-md-6 col-lg-6">Min : <span id="tempmin"></span></p>
                    <p class="col-xs-6 col-sm-6 col-md-6 col-lg-6">Max : <span id="tempmax"></span></p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Tweets de Michel Billaud</h3>
            </div>
            <div class="panel-body">
                <a class="twitter-timeline" data-height="250" href="https://twitter.com/MichelBillaud">Tweets by
                    MichelBillaud</a>
                <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>
        </div>
    </div>
    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
        <div class="panel panel-danger">

            <div class="panel-heading">
                <h3 class="panel-title">YouTube</h3>
            </div>
            <div class="panel-body">
                <div class="input-group has-error">
                    <input type="text" class="form-control" placeholder="Mot clé" id="yt">
                    <div class="input-group-btn">
                        <button class="btn btn-danger" type="submit" onclick="youtubeSearch()">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </div>
                </div>
                <br>
                <div class="embed-responsive embed-responsive-16by9">
                    <iframe class="embed-responsive-item" id="ytplayer"
                            src="http://www.youtube.com/embed?listType=search&list=INdes galantes"
                            frameborder="0"></iframe>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
        <div class="panel panel-success">
            <div class="panel-heading">
                <h3 class="panel-title">Google Maps</h3>
            </div>
            <div class="panel-body">
                <div class="input-group has-success">
                    <input type="text" class="form-control" placeholder="Lieu" id="mapSearch">
                    <div class="input-group-btn">
                        <button class="btn btn-success" type="submit" onclick="Deplace()">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </div>
                </div>
                <br>
                <div id="map" class="embed-responsive embed-responsive-16by9">

                </div>
            </div>
        </div>
    </div>

</div>
</body>
</html>
